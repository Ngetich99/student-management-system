<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazing Bawo Foundation</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo h1 {
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin-left: 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav ul li a:hover, nav ul li a.active {
            background-color: #3498db;
        }

        main {
            padding: 2rem;
            min-height: calc(100vh - 120px);
        }

        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        /* Dashboard Styles */
        .dashboard-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1.5rem;
        }

        .tab-button {
            padding: 0.8rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #555;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: #3498db;
        }

        .tab-button.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 1rem 0;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #444;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .save-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .save-btn:hover {
            background-color: #2980b9;
        }

        /* Data List Styles */
        .data-list, .view-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        .data-list h2, .view-container h1 {
            margin-bottom: 1.5rem;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
        }

        .list-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .student-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .student-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
            border: 3px solid #3498db;
        }

        .student-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .student-info {
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .student-info strong {
            color: #555;
        }

        .action-buttons {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn, .delete-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: opacity 0.3s;
        }

        .edit-btn {
            background-color: #f39c12;
            color: white;
        }

        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }

        .edit-btn:hover, .delete-btn:hover {
            opacity: 0.8;
        }

        /* Search Filter */
        .search-filter {
            display: flex;
            margin-bottom: 1.5rem;
        }

        #search-input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }

        #search-btn {
            padding: 0 1.5rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #search-btn:hover {
            background-color: #2980b9;
        }

        /* Login Styles */
        .login-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-bar {
            background: #2c3e50;
            color: white;
            padding: 0.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .timer-display {
            background: #3498db;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-button {
                border-bottom: none;
                border-left: 3px solid transparent;
                text-align: left;
            }
            
            .tab-button.active {
                border-bottom: none;
                border-left: 3px solid #3498db;
            }
            
            .list-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <h1>Amazing Bawo Foundation</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#" id="dashboard-link" class="active">Dashboard</a></li>
                <li><a href="#" id="view-link">View Data</a></li>
                <li><a href="#" id="login-link">Login</a></li>
            </ul>
        </nav>
    </header>

    <div id="admin-bar" class="admin-bar" style="display: none;">
        <div id="user-info">Welcome, <span id="username-display"></span> (<span id="role-display"></span>)</div>
        <div id="viewer-timer" class="timer-display" style="display: none;">Time remaining: 1:00</div>
        <button class="logout-btn" id="logout-btn">Logout</button>
    </div>

    <main id="main-content">
        <!-- Content will be loaded dynamically -->
    </main>

    <footer>
        <p>&copy; 2023 Amazing Bawo Foundation. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/dist/umd/supabase.min.js"></script>
    <script>
        // Supabase configuration - replace with your actual values
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // App state
        let currentUser = null;
        let userRole = null;
        let viewerTimer = null;
        let timeLeft = 60; // 1 minute in seconds

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            // Check auth state
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                await checkUserRole();
                setupUIForRole();
            } else {
                showLoginForm();
            }

            // Set up navigation
            setupNavigation();
        });

        // Navigation setup
        function setupNavigation() {
            document.getElementById('dashboard-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) loadDashboard();
            });
            
            document.getElementById('view-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) loadViewPage();
            });
            
            document.getElementById('login-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) {
                    handleLogout();
                } else {
                    showLoginForm();
                }
            });

            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                handleLogout();
            });
        }

        // Check user role from database
        async function checkUserRole() {
            if (!currentUser) return;
            
            const { data, error } = await supabase
                .from('profiles')
                .select('role')
                .eq('id', currentUser.id)
                .single();
            
            if (error) {
                console.error('Error fetching user role:', error);
                userRole = 'viewer'; // Default to viewer if error
            } else {
                userRole = data?.role || 'viewer';
            }
        }

        // Setup UI based on user role
        function setupUIForRole() {
            const adminBar = document.getElementById('admin-bar');
            const loginLink = document.getElementById('login-link');
            
            if (currentUser) {
                adminBar.style.display = 'flex';
                document.getElementById('username-display').textContent = currentUser.email;
                document.getElementById('role-display').textContent = userRole;
                loginLink.textContent = 'Logout';
                
                if (userRole === 'admin') {
                    loadDashboard();
                } else {
                    // Viewer - start timer and load view page
                    startViewerTimer();
                    loadViewPage();
                }
            } else {
                adminBar.style.display = 'none';
                loginLink.textContent = 'Login';
                showLoginForm();
            }
        }

        // Viewer timer functions
        function startViewerTimer() {
            if (userRole !== 'viewer') return;
            
            const timerDisplay = document.getElementById('viewer-timer');
            timerDisplay.style.display = 'block';
            
            viewerTimer = setInterval(() => {
                timeLeft--;
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `Time remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(viewerTimer);
                    alert('Your viewing session has expired. Please login again to continue.');
                    handleLogout();
                }
            }, 1000);
        }

        function resetViewerTimer() {
            if (viewerTimer) {
                clearInterval(viewerTimer);
                timeLeft = 60;
            }
        }

        // Authentication functions
        async function showLoginForm() {
            document.getElementById('main-content').innerHTML = `
                <div class="login-container">
                    <h2>Login</h2>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input type="password" id="password" required>
                        </div>
                        <button type="submit" class="save-btn">Login</button>
                    </form>
                    <p id="login-message"></p>
                </div>
            `;
            
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) {
                    document.getElementById('login-message').textContent = error.message;
                    document.getElementById('login-message').style.color = 'red';
                } else {
                    currentUser = data.user;
                    await checkUserRole();
                    setupUIForRole();
                }
            });
        }

        async function handleLogout() {
            resetViewerTimer();
            await supabase.auth.signOut();
            currentUser = null;
            userRole = null;
            setupUIForRole();
        }

        // Data operations with Supabase
        async function saveStudent(studentData) {
            if (userRole !== 'admin') {
                alert('Only admins can save student data');
                return null;
            }
            
            const { data, error } = await supabase
                .from('students')
                .insert([studentData])
                .select();
            
            if (error) {
                console.error('Error saving student:', error);
                return null;
            }
            return data[0];
        }

        async function updateStudent(id, updatedData) {
            if (userRole !== 'admin') {
                alert('Only admins can update student data');
                return false;
            }
            
            const { data, error } = await supabase
                .from('students')
                .update(updatedData)
                .eq('id', id)
                .select();
            
            if (error) {
                console.error('Error updating student:', error);
                return false;
            }
            return true;
        }

        async function deleteStudent(id) {
            if (userRole !== 'admin') {
                alert('Only admins can delete student data');
                return false;
            }
            
            const { error } = await supabase
                .from('students')
                .delete()
                .eq('id', id);
            
            if (error) {
                console.error('Error deleting student:', error);
                return false;
            }
            return true;
        }

        async function getStudentById(id) {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .eq('id', id)
                .single();
            
            if (error) {
                console.error('Error fetching student:', error);
                return null;
            }
            return data;
        }

        async function getAllStudents() {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('Error fetching students:', error);
                return [];
            }
            return data;
        }

        async function searchStudents(query) {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .or(`name.ilike.%${query}%,school.ilike.%${query}%,guardian.ilike.%${query}%`)
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('Error searching students:', error);
                return [];
            }
            return data;
        }

        // Page loading functions
        function loadDashboard() {
            if (userRole !== 'admin') {
                alert('Only admins can access the dashboard');
                loadViewPage();
                return;
            }
            
            document.getElementById('main-content').innerHTML = `
                <div class="dashboard-container">
                    <div class="tabs">
                        <button class="tab-button active" onclick="openTab('student-tab')">Student Details</button>
                        <button class="tab-button" onclick="openTab('school-tab')">School Details</button>
                        <button class="tab-button" onclick="openTab('guardian-tab')">Guardian Details</button>
                    </div>

                    <!-- Student Tab -->
                    <div id="student-tab" class="tab-content active">
                        <h2>Student Information</h2>
                        <form id="student-form">
                            <div class="form-group">
                                <label for="student-name">Full Name:</label>
                                <input type="text" id="student-name" required>
                            </div>
                            <div class="form-group">
                                <label for="student-dob">Date of Birth:</label>
                                <input type="date" id="student-dob" required>
                            </div>
                            <div class="form-group">
                                <label for="student-gender">Gender:</label>
                                <select id="student-gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="student-photo">Photo:</label>
                                <input type="file" id="student-photo" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label for="student-address">Address:</label>
                                <textarea id="student-address" rows="3"></textarea>
                            </div>
                            <button type="submit" class="save-btn">Save Student</button>
                        </form>
                    </div>

                    <!-- School Tab -->
                    <div id="school-tab" class="tab-content">
                        <h2>School Information</h2>
                        <form id="school-form">
                            <div class="form-group">
                                <label for="school-name">School Name:</label>
                                <input type="text" id="school-name" required>
                            </div>
                            <div class="form-group">
                                <label for="school-level">Education Level:</label>
                                <select id="school-level" required>
                                    <option value="">Select Level</option>
                                    <option value="Primary">Primary</option>
                                    <option value="Secondary">Secondary</option>
                                    <option value="Tertiary">Tertiary</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="school-grade">Grade/Class:</label>
                                <input type="text" id="school-grade">
                            </div>
                            <div class="form-group">
                                <label for="school-address">School Address:</label>
                                <textarea id="school-address" rows="3"></textarea>
                            </div>
                            <button type="submit" class="save-btn">Save School Info</button>
                        </form>
                    </div>

                    <!-- Guardian Tab -->
                    <div id="guardian-tab" class="tab-content">
                        <h2>Guardian Information</h2>
                        <form id="guardian-form">
                            <div class="form-group">
                                <label for="guardian-name">Guardian Name:</label>
                                <input type="text" id="guardian-name" required>
                            </div>
                            <div class="form-group">
                                <label for="guardian-relation">Relationship:</label>
                                <input type="text" id="guardian-relation" required>
                            </div>
                            <div class="form-group">
                                <label for="guardian-phone">Phone Number:</label>
                                <input type="tel" id="guardian-phone" required>
                            </div>
                            <div class="form-group">
                                <label for="guardian-email">Email:</label>
                                <input type="email" id="guardian-email">
                            </div>
                            <div class="form-group">
                                <label for="guardian-occupation">Occupation:</label>
                                <input type="text" id="guardian-occupation">
                            </div>
                            <button type="submit" class="save-btn">Save Guardian Info</button>
                        </form>
                    </div>
                </div>

                <div class="data-list">
                    <h2>Recently Added Students</h2>
                    <div id="student-list" class="list-container">
                        <!-- Student data will appear here -->
                    </div>
                </div>
            `;
            
            // Set up form event listeners
            document.getElementById('student-form').addEventListener('submit', handleStudentFormSubmit);
            document.getElementById('school-form').addEventListener('submit', handleSchoolFormSubmit);
            document.getElementById('guardian-form').addEventListener('submit', handleGuardianFormSubmit);
            
            // Display recent students
            displayRecentStudents();
            
            // Check for student to edit
            const studentToEdit = JSON.parse(localStorage.getItem('editStudent'));
            if (studentToEdit) {
                // Pre-fill forms with student data
                document.getElementById('student-name').value = studentToEdit.name || '';
                document.getElementById('student-dob').value = studentToEdit.dob || '';
                document.getElementById('student-gender').value = studentToEdit.gender || '';
                document.getElementById('student-address').value = studentToEdit.address || '';
                
                document.getElementById('school-name').value = studentToEdit.school_name || '';
                document.getElementById('school-level').value = studentToEdit.school_level || '';
                document.getElementById('school-grade').value = studentToEdit.school_grade || '';
                document.getElementById('school-address').value = studentToEdit.school_address || '';
                
                document.getElementById('guardian-name').value = studentToEdit.guardian_name || '';
                document.getElementById('guardian-relation').value = studentToEdit.guardian_relation || '';
                document.getElementById('guardian-phone').value = studentToEdit.guardian_phone || '';
                document.getElementById('guardian-email').value = studentToEdit.guardian_email || '';
                document.getElementById('guardian-occupation').value = studentToEdit.guardian_occupation || '';
                
                // Remove from localStorage
                localStorage.removeItem('editStudent');
                
                // Show message
                alert('You are now editing this student record. Update the information and save the guardian form to update.');
            }
        }

        function loadViewPage() {
            document.getElementById('main-content').innerHTML = `
                <div class="view-container">
                    <h1>Student Records</h1>
                    <div class="search-filter">
                        <input type="text" id="search-input" placeholder="Search students...">
                        <button id="search-btn">Search</button>
                    </div>
                    
                    <div id="all-students-list" class="list-container">
                        <!-- All student data will appear here -->
                    </div>
                </div>
            `;
            
            // Set up search functionality
            document.getElementById('search-btn').addEventListener('click', handleSearch);
            document.getElementById('search-input').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            
            // Display all students
            displayAllStudents();
        }

        // Tab functionality
        function openTab(tabId) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show the selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Activate the clicked button
            event.currentTarget.classList.add('active');
        }

        // Form Handlers
        async function handleStudentFormSubmit(e) {
            e.preventDefault();
            
            const photoFile = document.getElementById('student-photo').files[0];
            let photoUrl = '';
            
            if (photoFile) {
                // In a real app, you would upload this to Supabase Storage
                photoUrl = URL.createObjectURL(photoFile);
            }
            
            currentStudent = {
                name: document.getElementById('student-name').value,
                dob: document.getElementById('student-dob').value,
                gender: document.getElementById('student-gender').value,
                photo_url: photoUrl,
                address: document.getElementById('student-address').value
            };
            
            // Clear form
            e.target.reset();
            
            // Show success message
            alert('Student information saved temporarily. Please proceed to fill school and guardian information.');
        }

        async function handleSchoolFormSubmit(e) {
            e.preventDefault();
            
            currentStudent = {
                ...currentStudent,
                school_name: document.getElementById('school-name').value,
                school_level: document.getElementById('school-level').value,
                school_grade: document.getElementById('school-grade').value,
                school_address: document.getElementById('school-address').value
            };
            
            // Clear form
            e.target.reset();
            
            // Show success message
            alert('School information saved temporarily. Please proceed to fill guardian information.');
        }

        async function handleGuardianFormSubmit(e) {
            e.preventDefault();
            
            const completeStudent = {
                ...currentStudent,
                guardian_name: document.getElementById('guardian-name').value,
                guardian_relation: document.getElementById('guardian-relation').value,
                guardian_phone: document.getElementById('guardian-phone').value,
                guardian_email: document.getElementById('guardian-email').value,
                guardian_occupation: document.getElementById('guardian-occupation').value
            };
            
            // Save the complete student record
            const savedStudent = await saveStudent(completeStudent);
            
            if (savedStudent) {
                // Clear form and current student
                e.target.reset();
                currentStudent = {};
                
                // Show success message
                alert('Student record saved successfully!');
                
                // Refresh the student list
                if (document.getElementById('student-list')) {
                    displayRecentStudents();
                }
            }
        }

        // Display Functions
        async function displayRecentStudents() {
            const allStudents = await getAllStudents();
            const recentStudents = allStudents.slice(0, 5); // Get first 5
            
            const studentList = document.getElementById('student-list');
            studentList.innerHTML = '';
            
            if (recentStudents.length === 0) {
                studentList.innerHTML = '<p>No students added yet.</p>';
                return;
            }
            
            recentStudents.forEach(student => {
                studentList.appendChild(createStudentCard(student));
            });
        }

        async function displayAllStudents(filteredStudents = null) {
            const studentsToDisplay = filteredStudents || await getAllStudents();
            
            const allStudentsList = document.getElementById('all-students-list');
            allStudentsList.innerHTML = '';
            
            if (studentsToDisplay.length === 0) {
                allStudentsList.innerHTML = '<p>No students found.</p>';
                return;
            }
            
            studentsToDisplay.forEach(student => {
                allStudentsList.appendChild(createStudentCard(student, userRole === 'admin'));
            });
        }

        function createStudentCard(student, showActions = false) {
            const card = document.createElement('div');
            card.className = 'student-card';
            
            let photoHtml = '';
            if (student.photo_url) {
                photoHtml = `<img src="${student.photo_url}" alt="${student.name}" class="student-photo">`;
            } else {
                photoHtml = '<div class="student-photo" style="background-color: #eee; display: flex; align-items: center; justify-content: center;">No Photo</div>';
            }
            
            let actionsHtml = '';
            if (showActions) {
                actionsHtml = `
                    <div class="action-buttons">
                        <button class="edit-btn" onclick="editStudent('${student.id}')">Edit</button>
                        <button class="delete-btn" onclick="deleteStudentPrompt('${student.id}')">Delete</button>
                    </div>
                `;
            }
            
            card.innerHTML = `
                ${photoHtml}
                <div class="student-name">${student.name}</div>
                <div class="student-info"><strong>DOB:</strong> ${student.dob || 'N/A'}</div>
                <div class="student-info"><strong>Gender:</strong> ${student.gender || 'N/A'}</div>
                <div class="student-info"><strong>School:</strong> ${student.school_name || 'N/A'}</div>
                <div class="student-info"><strong>Grade:</strong> ${student.school_grade || 'N/A'}</div>
                <div class="student-info"><strong>Guardian:</strong> ${student.guardian_name || 'N/A'}</div>
                ${actionsHtml}
            `;
            
            return card;
        }

        // Edit and Delete Functions
        async function editStudent(id) {
            if (userRole !== 'admin') {
                alert('Only admins can edit student records');
                return;
            }
            
            const student = await getStudentById(id);
            if (!student) return;
            
            // Store student to edit
            localStorage.setItem('editStudent', JSON.stringify(student));
            
            // Load dashboard with student data to edit
            loadDashboard();
        }

        async function deleteStudentPrompt(id) {
            if (userRole !== 'admin') {
                alert('Only admins can delete student records');
                return;
            }
            
            if (confirm('Are you sure you want to delete this student record? This action cannot be undone.')) {
                if (await deleteStudent(id)) {
                    alert('Student record deleted successfully.');
                    displayAllStudents();
                } else {
                    alert('Failed to delete student record.');
                }
            }
        }

        // Search Function
        async function handleSearch() {
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                const results = await searchStudents(query);
                displayAllStudents(results);
            } else {
                displayAllStudents();
            }
        }
    </script>
</body>
</html>
